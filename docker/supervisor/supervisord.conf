[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor/
loglevel=info

[unix_http_server]
file=/var/run/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///var/run/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface

[program:nginx]
command=/usr/sbin/nginx -g "daemon off;"
user=root
autostart=true
autorestart=true
startsecs=5
startretries=3
stderr_logfile=/var/log/nginx/error.log
stdout_logfile=/var/log/nginx/access.log
priority=900

[program:api]
command=node /app/api/index.js
directory=/app/api
user=a2zsoc
autostart=true
autorestart=true
startsecs=10
startretries=3
stderr_logfile=/var/log/supervisor/api-error.log
stdout_logfile=/var/log/supervisor/api.log
environment=NODE_ENV="production",PORT="3001"
priority=800

[program:worker-alerts]
command=node /app/api/workers/alertProcessor.js
directory=/app/api
user=a2zsoc
autostart=true
autorestart=true
startsecs=10
startretries=3
stderr_logfile=/var/log/supervisor/worker-alerts-error.log
stdout_logfile=/var/log/supervisor/worker-alerts.log
environment=NODE_ENV="production"
priority=700

[program:worker-ai]
command=node /app/api/workers/aiProcessor.js
directory=/app/api
user=a2zsoc
autostart=true
autorestart=true
startsecs=10
startretries=3
stderr_logfile=/var/log/supervisor/worker-ai-error.log
stdout_logfile=/var/log/supervisor/worker-ai.log
environment=NODE_ENV="production"
priority=700

[program:worker-compliance]
command=node /app/api/workers/complianceProcessor.js
directory=/app/api
user=a2zsoc
autostart=true
autorestart=true
startsecs=10
startretries=3
stderr_logfile=/var/log/supervisor/worker-compliance-error.log
stdout_logfile=/var/log/supervisor/worker-compliance.log
environment=NODE_ENV="production"
priority=700

[group:workers]
programs=worker-alerts,worker-ai,worker-compliance
priority=700 